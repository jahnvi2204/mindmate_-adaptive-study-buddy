"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9135:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>S,routeModule:()=>v,serverHooks:()=>k,staticGenerationAsyncStorage:()=>E});var o={};r.r(o),r.d(o,{GET:()=>m});var s=r(9303),n=r(8716),a=r(670),i=r(7070),l=r(1482),u=r.n(l),c=r(6113),g=r.n(c);let p={httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:604800},d=e=>{try{let t=process.env.APP_SECRET;if(!t||"change-me"===t)return console.warn("APP_SECRET not set or using default, cannot verify signed state"),null;let r=e.split(".");if(2!==r.length)return console.error("Invalid signed state format"),null;let[o,s]=r;if(!o||!s)return console.error("Missing state or signature in signed state"),null;let n=g().createHmac("sha256",t).update(o).digest("hex");if(s===n)return o;return console.error("Signature mismatch in state verification",{receivedSignature:s.substring(0,16)+"...",expectedSignature:n.substring(0,16)+"...",stateLength:o.length,appSecretSet:!!t,appSecretLength:t?.length||0}),null}catch(e){return console.error("Error verifying signed state:",e),null}},f=e=>"http://localhost:3001".replace(/\/$/,""),h=e=>{let[,t]=e.split(".");return JSON.parse(Buffer.from(t,"base64").toString("utf8"))};async function m(e){let{searchParams:t}=new URL(e.url),r=t.get("code"),o=t.get("state"),s=e.cookies.get("oauth_state")?.value;if(!r)return console.error("OAuth callback missing 'code' parameter"),i.NextResponse.json({error:"Missing authorization code"},{status:400});if(!o)return console.error("OAuth callback missing 'state' parameter"),i.NextResponse.json({error:"Missing state parameter"},{status:400});let n=d(o);if(console.log("State verification:",{hasCookie:!!s,cookieState:s?s.substring(0,8)+"...":null,hasSignedState:!!o,verifiedState:n?n.substring(0,8)+"...":null,allCookies:e.cookies.getAll().map(e=>e.name)}),s&&n)n===s?console.log("State verification successful via cookie match"):(console.error("State mismatch detected:",{cookieState:s.substring(0,20),verifiedState:n.substring(0,20),fullCookieState:s,fullVerifiedState:n}),console.warn("Cookie state doesn't match, but signed state is valid. Using signed state."));else if(n)console.warn("OAuth state cookie not found, using signed state verification");else if(s)return console.error("Cookie exists but signed state verification failed"),console.error("Signed state param:",o),console.error("Cookie state:",s),i.NextResponse.json({error:"Invalid state parameter",details:"State verification failed. The state signature is invalid."},{status:400});else return console.error("OAuth state cookie not found and signed state verification failed"),console.error("State from URL:",o),console.error("All cookies:",e.cookies.getAll().map(e=>e.name)),i.NextResponse.json({error:"State cookie not found. Please try logging in again.",details:"The OAuth state cookie was not found and state verification failed. This may happen if cookies are blocked or the session expired."},{status:400});let a=f(e);if(!process.env.GOOGLE_CLIENT_ID)return console.error("Missing GOOGLE_CLIENT_ID environment variable"),i.NextResponse.json({error:"Server configuration error: GOOGLE_CLIENT_ID is not set"},{status:500});if(!process.env.GOOGLE_CLIENT_SECRET)return console.error("Missing GOOGLE_CLIENT_SECRET environment variable"),i.NextResponse.json({error:"Server configuration error: GOOGLE_CLIENT_SECRET is not set"},{status:500});try{let e=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:r,client_id:process.env.GOOGLE_CLIENT_ID,client_secret:process.env.GOOGLE_CLIENT_SECRET,redirect_uri:`${a}/api/auth/google/callback`,grant_type:"authorization_code"})});if(!e.ok){let t=await e.text();return console.error("Token exchange failed:",t),i.NextResponse.json({error:"Token exchange failed"},{status:400})}let t=(await e.json()).id_token;if(!t)return i.NextResponse.json({error:"Missing id_token"},{status:400});let o=h(t),s=process.env.APP_SECRET;if(!s)return console.error("Missing APP_SECRET environment variable"),i.NextResponse.json({error:"Server configuration error: APP_SECRET is not set"},{status:500});if("change-me"===s)return console.error("APP_SECRET is still set to default value 'change-me'"),i.NextResponse.json({error:"Server configuration error: APP_SECRET must be changed from default value"},{status:500});let n=u().sign({sub:o.sub,name:o.name,email:o.email,picture:o.picture},s,{expiresIn:"7d"}),l=i.NextResponse.redirect(a||"/");return l.cookies.set("session",n,p),l.cookies.delete("oauth_state"),l}catch(e){return console.error(e),i.NextResponse.json({error:"OAuth error"},{status:500})}}let v=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/google/callback/route",pathname:"/api/auth/google/callback",filename:"route",bundlePath:"app/api/auth/google/callback/route"},resolvedPagePath:"C:\\Users\\JAHNVI SAXENA\\Desktop\\mindmate_-adaptive-study-buddy\\app\\api\\auth\\google\\callback\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:S,staticGenerationAsyncStorage:E,serverHooks:k}=v,x="/api/auth/google/callback/route";function _(){return(0,a.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:E})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972,482],()=>r(9135));module.exports=o})();